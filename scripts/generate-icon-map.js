#!/usr/bin/env node

/**
 * Generate Icon Map
 * 
 * This script generates a JavaScript object that maps icon names to their file paths.
 * The map supports all three styles: solid, outline, and duotone.
 * 
 * Usage: node scripts/generate-icon-map.js
 * Output: dist/icon-map.js
 */

const fs = require('fs');
const path = require('path');

const ICONS_DIR = path.join(__dirname, '../icons');
const DIST_DIR = path.join(__dirname, '../dist');
const OUTPUT_FILE = path.join(DIST_DIR, 'icon-map.js');

// Ensure dist directory exists
if (!fs.existsSync(DIST_DIR)) {
  fs.mkdirSync(DIST_DIR, { recursive: true });
}

/**
 * Recursively get all SVG files from a directory
 */
function getSVGFiles(dir, style) {
  const files = fs.readdirSync(dir);
  return files
    .filter(file => file.endsWith('.svg'))
    .map(file => ({
      name: file.replace('.svg', ''),
      file: file,
      style: style
    }));
}

/**
 * Generate the icon map
 */
function generateIconMap() {
  const iconMap = {
    solid: {},
    outline: {},
    duotone: {}
  };

  const styles = ['solid', 'outline', 'duotone'];

  styles.forEach(style => {
    const styleDir = path.join(ICONS_DIR, style);
    
    if (fs.existsSync(styleDir)) {
      const icons = getSVGFiles(styleDir, style);
      
      icons.forEach(icon => {
        iconMap[style][icon.name] = `./svg/${style}/${icon.file}`;
      });
    }
  });

  return iconMap;
}

/**
 * Write the icon map to a JavaScript file
 */
function writeIconMap(iconMap) {
  const output = `/**
 * Generated Icon Map
 * 
 * This file is auto-generated by scripts/generate-icon-map.js
 * Do not edit manually.
 * 
 * Usage:
 *   const iconMap = require('./icon-map.js');
 *   const heartSolidPath = iconMap.solid.heart;
 */

module.exports = ${JSON.stringify(iconMap, null, 2)};
`;

  fs.writeFileSync(OUTPUT_FILE, output, 'utf8');
  console.log(`✅ Icon map generated: ${OUTPUT_FILE}`);
  console.log(`   - Solid icons: ${Object.keys(iconMap.solid).length}`);
  console.log(`   - Outline icons: ${Object.keys(iconMap.outline).length}`);
  console.log(`   - Duotone icons: ${Object.keys(iconMap.duotone).length}`);
}

try {
  const iconMap = generateIconMap();
  writeIconMap(iconMap);
} catch (error) {
  console.error('❌ Error generating icon map:', error.message);
  process.exit(1);
}
